<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Vehicle - Inventory System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .btn-primary { background-color: #0066cc; border-color: #0066cc; }
        .btn-primary:hover { background-color: #0052a3; border-color: #0052a3; }
        .form-container { max-width: 800px; margin: 0 auto; }
        .year-checkbox { margin: 0.25rem; }
        .year-selection { max-height: 300px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 0.375rem; padding: 1rem; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('admin_dashboard') }}">
                <i class="fas fa-car me-2"></i>Admin Panel
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="{{ url_for('admin_dashboard') }}">
                    <i class="fas fa-home me-1"></i>Dashboard
                </a>
                <a class="nav-link" href="{{ url_for('admin_vehicles') }}">
                    <i class="fas fa-list me-1"></i>Manage Vehicles
                </a>
                <a class="nav-link" href="{{ url_for('home') }}" target="_blank">
                    <i class="fas fa-external-link-alt me-1"></i>View Website
                </a>
                <a class="nav-link" href="{{ url_for('admin_logout') }}">
                    <i class="fas fa-sign-out-alt me-1"></i>Logout
                </a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="form-container">
            <div class="row mb-4">
                <div class="col">
                    <h1><i class="fas fa-plus me-2"></i>Add New Vehicle</h1>
                    <p class="lead">Add a new vehicle model to your inventory</p>
                </div>
            </div>

            <div class="card">
                <div class="card-body">
                    <form id="addVehicleForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="make" class="form-label">Make <span class="text-danger">*</span></label>
                                <select class="form-select" id="make" name="make" required>
                                    <option value="">Select Make</option>
                                    <option value="Ford">Ford</option>
                                    <option value="Lincoln">Lincoln</option>
                                    <option value="Jeep">Jeep</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="model" class="form-label">Model <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="model" name="model" required>
                                <div class="form-text">e.g., F-150, Mustang, Wrangler, Navigator</div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="category" class="form-label">Category</label>
                                <select class="form-select" id="category" name="category">
                                    <option value="">Select Category</option>
                                    <option value="Sedan">Sedan</option>
                                    <option value="SUV">SUV</option>
                                    <option value="Truck">Truck</option>
                                    <option value="Coupe">Coupe</option>
                                    <option value="Convertible">Convertible</option>
                                    <option value="Hatchback">Hatchback</option>
                                    <option value="Wagon">Wagon</option>
                                    <option value="Luxury">Luxury</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="status" class="form-label">Status</label>
                                <select class="form-select" id="status" name="status">
                                    <option value="Available">Available</option>
                                    <option value="Limited">Limited Availability</option>
                                    <option value="Coming Soon">Coming Soon</option>
                                    <option value="Discontinued">Discontinued</option>
                                </select>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="description" class="form-label">Description</label>
                            <textarea class="form-control" id="description" name="description" rows="3"></textarea>
                            <div class="form-text">Brief description of the vehicle</div>
                        </div>

                        <div class="mb-3">
                            <label for="price_range" class="form-label">Price Range</label>
                            <input type="text" class="form-control" id="price_range" name="price_range" placeholder="e.g., $25,000 - $45,000">
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Available Years <span class="text-danger">*</span></label>
                            <div class="row mb-2">
                                <div class="col-auto">
                                    <button type="button" class="btn btn-outline-secondary btn-sm" onclick="selectYearRange()">
                                        <i class="fas fa-calendar-alt me-1"></i>Select Range
                                    </button>
                                </div>
                                <div class="col-auto">
                                    <button type="button" class="btn btn-outline-secondary btn-sm" onclick="selectAllYears()">
                                        <i class="fas fa-check-double me-1"></i>Select All
                                    </button>
                                </div>
                                <div class="col-auto">
                                    <button type="button" class="btn btn-outline-secondary btn-sm" onclick="clearAllYears()">
                                        <i class="fas fa-times me-1"></i>Clear All
                                    </button>
                                </div>
                            </div>
                            <div class="year-selection">
                                <div class="row" id="yearsContainer">
                                    <!-- Years will be generated by JavaScript -->
                                </div>
                            </div>
                            <div class="form-text">Select the years this vehicle model is available</div>
                        </div>

                        <div class="mb-3">
                            <label for="features" class="form-label">Features</label>
                            <input type="text" class="form-control" id="features" name="features" 
                                   placeholder="Enter features separated by commas">
                            <div class="form-text">e.g., All-Wheel Drive, Sunroof, Navigation System</div>
                        </div>

                        <div class="d-flex justify-content-between">
                            <a href="{{ url_for('admin_vehicles') }}" class="btn btn-secondary">
                                <i class="fas fa-arrow-left me-2"></i>Cancel
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-2"></i>Add Vehicle
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Generate year checkboxes
        function generateYearCheckboxes() {
            const container = document.getElementById('yearsContainer');
            const currentYear = new Date().getFullYear();
            const startYear = 1990;
            
            for (let year = currentYear; year >= startYear; year--) {
                const colDiv = document.createElement('div');
                colDiv.className = 'col-sm-2 col-3';
                
                const checkDiv = document.createElement('div');
                checkDiv.className = 'form-check year-checkbox';
                
                const checkbox = document.createElement('input');
                checkbox.className = 'form-check-input';
                checkbox.type = 'checkbox';
                checkbox.id = `year_${year}`;
                checkbox.value = year;
                checkbox.name = 'years';
                
                const label = document.createElement('label');
                label.className = 'form-check-label';
                label.htmlFor = `year_${year}`;
                label.textContent = year;
                
                checkDiv.appendChild(checkbox);
                checkDiv.appendChild(label);
                colDiv.appendChild(checkDiv);
                container.appendChild(colDiv);
            }
        }

        function selectYearRange() {
            const startYear = prompt('Enter start year (e.g., 2020):');
            const endYear = prompt('Enter end year (e.g., 2025):');
            
            if (startYear && endYear) {
                const start = parseInt(startYear);
                const end = parseInt(endYear);
                
                clearAllYears();
                
                for (let year = Math.min(start, end); year <= Math.max(start, end); year++) {
                    const checkbox = document.getElementById(`year_${year}`);
                    if (checkbox) checkbox.checked = true;
                }
            }
        }

        function selectAllYears() {
            const checkboxes = document.querySelectorAll('input[name="years"]');
            checkboxes.forEach(cb => cb.checked = true);
        }

        function clearAllYears() {
            const checkboxes = document.querySelectorAll('input[name="years"]');
            checkboxes.forEach(cb => cb.checked = false);
        }

        // Form submission
        document.getElementById('addVehicleForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const selectedYears = [];
            
            // Get selected years
            document.querySelectorAll('input[name="years"]:checked').forEach(cb => {
                selectedYears.push(parseInt(cb.value));
            });
            
            if (selectedYears.length === 0) {
                alert('Please select at least one year for this vehicle.');
                return;
            }
            
            // Prepare data
            const data = {
                make: formData.get('make'),
                model: formData.get('model'),
                category: formData.get('category'),
                description: formData.get('description'),
                price_range: formData.get('price_range'),
                status: formData.get('status'),
                features: formData.get('features') ? formData.get('features').split(',').map(f => f.trim()) : [],
                years: selectedYears
            };
            
            // Submit each year separately
            let promises = [];
            selectedYears.forEach(year => {
                const yearData = { ...data, year: year };
                promises.push(
                    fetch('/vehicle/add', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(yearData)
                    })
                );
            });
            
            Promise.all(promises)
                .then(responses => Promise.all(responses.map(r => r.json())))
                .then(results => {
                    const allSuccess = results.every(r => r.success);
                    if (allSuccess) {
                        alert('Vehicle added successfully!');
                        window.location.href = '/vehicles';
                    } else {
                        alert('Some errors occurred while adding the vehicle.');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred while adding the vehicle.');
                });
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            generateYearCheckboxes();
        });
    </script>
</body>
</html> 